pipeline {
    agent any
    options { timestamps() }

    stages {
        stage('Checkout main repo') {
            steps {
                echo "Checking out main repository..."
                checkout([
                    $class: 'GitSCM',
                    branches: [[name: '*/main']],
                    userRemoteConfigs: [[
                        url: 'https://github.com/vishwa2311/jenkins-pipeline-demo.git',
                        credentialsId: 'github-pat'
                    ]]
                ])
                bat '@echo off & echo ‚úÖ Main repo checked out & dir'
            }
        }

        stage('Checkout lib repo') {
            steps {
                dir('libs') {
                    echo "Checking out library repository into 'libs' folder..."
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: '*/main']],
                        userRemoteConfigs: [[
                            url: 'https://github.com/vishwa2311/my-jenkins.git',
                            credentialsId: 'github-pat'
                        ]]
                    ])
                    bat '@echo off & echo ‚úÖ Lib repo checked out & dir'
                }
            }
        }

        stage('Combined Build') {
            steps {
                bat '@echo off & echo üèóÔ∏è Running combined build across repos... & powershell -Command "Start-Sleep -Seconds 2"'
            }
        }
    }

    post {
        always {
            echo "‚úÖ Multi-repo pipeline finished successfully."
        }
    }
}
